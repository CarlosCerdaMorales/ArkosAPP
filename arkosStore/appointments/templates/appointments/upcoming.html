{% extends 'base.html' %}
{% load static %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'appointments/upcoming.css' %}">
<link rel="stylesheet" href="{% static 'accounts/profile.css' %}">

<style>
    .btn-back-container {
        margin-top: 40px;
        text-align: center;
        padding-top: 30px;
        border-top: 1px solid #bfe3ef;
    }
    
    .btn-back-custom {
        display: inline-flex;
        align-items: center;
        gap: 10px; 
        background-color: #00373E;
        color: white !important;
        padding: 12px 35px;
        border-radius: 50px; 
        font-weight: 600;
        text-decoration: none;
        transition: all 0.3s ease;
        box-shadow: 0 5px 15px rgba(0, 55, 62, 0.2);
    }

    .btn-back-custom:hover {
        background-color: #004d57; 
        transform: translateY(-3px); 
        box-shadow: 0 10px 25px rgba(0, 55, 62, 0.3);
    }

    .arrow-icon {
        transition: transform 0.3s ease;
    }

    .btn-back-custom:hover .arrow-icon {
        transform: translateX(-5px);
    }
</style>
{% endblock %}

{% block content %}

{% if messages %}
    {% for message in messages %}
        <div class="success-banner {% if message.tags == 'error' %}banner-error{% else %}banner-success{% endif %}">
            {{ message }}
        </div>
    {% endfor %}
{% endif %}

<div class="up-wrapper">
    <h2 class="up-title">Citas programadas</h2>

    <div class="up-card">
        {% for app in appointments %}
        <div class="up-item">
            <div class="up-data">
                <b>Fecha:</b> {{ app.datetime|date:"d/m/Y H:i" }} <br>
                <b>Tipo:</b> {{ app.service.get_name_display }} <br>
                <b>Trabajador:</b> {{ app.worker.name }}
            </div>
            
            <button 
                class="cancel-btn" 
                data-url="{% url 'cancel_appointment' app.id %}"
                onclick="openCancelModal(this.dataset.url)">
                Cancelar
            </button>
        </div>
        {% empty %}
        <div style="text-align: center; padding: 20px; color: #00373E;">
            <p class="no-appointments">No tienes ninguna cita programada.</p>
        </div>
        {% endfor %}

        <div class="btn-back-container">
            <a href="{% url 'profile' %}" class="btn-back-custom">
                <span class="arrow-icon">&larr;</span> Volver al perfil
            </a>
        </div>

    </div>
</div>

<div class="confirm-modal-overlay" id="cancelModal" style="display: none;">
    <div class="confirm-modal">
        <div class="confirm-title">¿Estás seguro?</div>
        <div class="confirm-text">
            Vas a cancelar tu cita. El hueco quedará libre para otros usuarios.
            <br><br>
            <small style="color: #666;">(Solo se permite cancelar con más de 12h de antelación)</small>
        </div>
        <div class="confirm-btns">
            <button class="modal-btn modal-btn-cancel" onclick="closeCancelModal()">Volver</button>
            
            <a id="confirmDeleteBtn" href="#" class="modal-btn modal-btn-confirm">
                Sí, cancelar
            </a>
        </div>
    </div>
</div>

<script>
    const modal = document.getElementById('cancelModal');
    const confirmBtn = document.getElementById('confirmDeleteBtn');

    function openCancelModal(cancelUrl) {
        confirmBtn.href = cancelUrl;
        modal.style.display = 'flex';
    }

    function closeCancelModal() {
        modal.style.display = 'none';
    }

    window.onclick = function(event) {
        if (event.target == modal) {
            closeCancelModal();
        }
    }

    document.addEventListener("DOMContentLoaded", function() {
        const banners = document.querySelectorAll('.success-banner');
        if (banners.length > 0) {
            setTimeout(function() {
                banners.forEach(banner => {
                    banner.style.opacity = '0';
                    setTimeout(() => banner.remove(), 500);
                });
            }, 3500);
        }
    });
</script>

{% endblock %}